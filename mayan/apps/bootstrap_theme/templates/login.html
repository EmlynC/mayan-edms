{% extends 'skeleton.html' %}

{% load i18n %}

{% load theme_tags %}
{% load autoadmin_tags %}
{% load bootstrap3 %}
{% load project_tags %}
{% load static %}

{#{% block meta %}#}
{#  {% if not user.is_authenticated %}#}
{#    {% get_login_redirect_url %}#}
{#    <meta http-equiv="REFRESH" content="5;url={{ LOGIN_REDIRECT_URL }}">#}
{#  {% endif %}#}
{#{% endblock %}#}

{% block html_title %}{% trans 'Login' %}{% endblock %}

{% if not user.is_authenticated %}
  {% block main_content %}
    {% get_login_redirect_url %}
    <div class="content">
      <h2 class="title">{% trans 'You are already logged in' %}</h2>
      <div class="inner">
        <p>
          {% trans 'Redirecting you to the website entry point in 5 seconds.' %}
        <p>
        </p>
        {% blocktrans %}Or click <a href="{{ LOGIN_REDIRECT_URL }}">here</a> if redirection doesn't work.{% endblocktrans %}
        </p>
      </div>
    </div>
  {% endblock %}
{% else %}
  {% block body_content %}
    {% auto_admin_properties %}
    {% if auto_admin_properties.account %}
      <div class="panel panel-info">
        <div class="panel-heading">
          <h3 class="panel-title">{% trans "First time login" %}</h3>
        </div>
        <div class="panel-body">
          <p>{% trans 'You have just finished installing <strong>Mayan EDMS</strong>, congratulations!' %}</p>
          <p>{% trans 'Login using the following credentials:' %}</p>
          <p>{% blocktrans with auto_admin_properties.account as account %}Username: <strong>{{ account }}</strong>{% endblocktrans %}</p>
          <p>{% blocktrans with auto_admin_properties.account.email as email %}Email: <strong>{{ email }}</strong>{% endblocktrans %}</p>
          <p>{% blocktrans with auto_admin_properties.password as password %}Password: <strong>{{ password }}</strong>{% endblocktrans %}</p>
          <p>{% trans 'Be sure to change the password to increase security and to disable this message.' %}</p>
        </div>
      </div>
    {% endif %}
    <h2>{% block project_name %}{% project_name %}{% endblock %} <small>on Mayan EDMS</small></h2>
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">{% trans 'Login' %}</h3>
      </div>
      <div class="panel-body" id="login-panel">

        <form action="." method="post" class="form login">
          {% csrf_token %}
          {% bootstrap_form form %}

          <input type="hidden" name="next" value="{{ next|escape }}" />

          {% buttons %}
            <button type="submit" class="btn btn-primary">
             {% bootstrap_icon "log-in" %} {% trans 'Login' %}
            </button>
          {% endbuttons %}

        </form>

      </div>
    </div>

    {% get_bootstrap_theme_setting "VERBOSE_LOGIN" as verbose_login %}
    {% if verbose_login %}
      {% include 'verbose_login.html' %}
    {% endif %}
  {% endblock %}
  </div>
{% endif %}
